import java.awt.BorderLayout;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;

import javax.swing.*;
import javax.swing.border.EmptyBorder;
import javax.swing.filechooser.FileNameExtensionFilter;
import javax.swing.filechooser.FileSystemView;

public class ControlPanel {
	private static JFrame frame = new JFrame();
	private static JLabel status = new JLabel("状态：等待初始化");
	private static JPanel work_panel = new JPanel();
	private static JPanel init_panel = new JPanel();
	private static Datapath datapath = null;
	
	public ControlPanel()
	{
		init();
		JPanel panel = (JPanel) frame.getContentPane();
		panel.setBorder(new EmptyBorder(10,15,10,15));
		frame.setSize(250,250);
		frame.add(init_panel);
		frame.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);
		frame.addWindowListener(new WindowAdapter(){
			public void windowClosing(WindowEvent e)
			{
				int confirm = JOptionPane.showOptionDialog(null, "单击确定以退出，您当前的拍摄记录将会被自动保存。", 
						"退出确认", JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE, null, null, null);
				if(confirm == 0) {
					if(datapath != null) {
						datapath.save();
					}
					System.exit(0);
				}
			}
		});
		frame.setVisible(true);
	}
	
	public void init()
	{
		init_panel.setLayout(new BorderLayout(0,10));
		JButton btn1 = new JButton("New");
			btn1.addActionListener(e -> newProject());
		init_panel.add(btn1,BorderLayout.CENTER);
		JButton btn2 = new JButton("Load");
			btn2.addActionListener(e -> loadProject());
		init_panel.add(btn2,BorderLayout.CENTER);
		init_panel.add(status, BorderLayout.SOUTH);
		
	}
	
	public void newProject()
	{
		datapath = new Datapath();
		status.setText("新建项目成功");
	}
	
	public void loadProject()
	{
		try {
			JFileChooser fchooser = new JFileChooser(FileSystemView.getFileSystemView().getHomeDirectory().getPath());
			fchooser.setDialogTitle("请选择缓存文件（非学生名单）");
			FileNameExtensionFilter filter = new FileNameExtensionFilter("txt file","txt");
			fchooser.setFileFilter(filter);
			int returnVal = fchooser.showOpenDialog(null);
			if(returnVal == JFileChooser.APPROVE_OPTION){
				String path = fchooser.getSelectedFile().getPath();
				datapath = new Datapath(path);
				status.setText("导入项目成功");
			}
		} catch(Exception e) {
			e.printStackTrace();
		}
	}
	
	public static void main(String[] args)
	{
		ControlPanel c = new ControlPanel();
	}
}
